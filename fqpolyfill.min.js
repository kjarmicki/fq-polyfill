/*
 * Feature Queries (@supports) polyfill v0.7
 *
 *
 * Drop-in polyfill for window.CSS.supports and @supports CSS rules
 * Licensed MIT
 *
 * @author Krystian Jarmicki
 * @preserve
 */

(function(e){"use strict";var t=function(){var e=Array.prototype.slice.call(arguments),t,n,r=e[0];for(t=1;t<e.length;t++){for(n in e[t]){r[n]=e[t][n]}}return r};var n=function(t){return Array.prototype.slice.call(e.document.querySelectorAll(t))};var r=e._fqPolyfill={};r.TERMINALS={_END:0,OR:1,AND:2,NOT:3,OPEN_BRACKET:4,CLOSE_BRACKET:5,SINGLE_QUOTED_CONTENT:6,DOUBLE_QUOTED_CONTENT:7,DOUBLE_COLON:8,RULENAME:9,ARITHMETIC:10};r.CHARACTER_SETS={NEWLINE_N:/\n+/g,NEWLINE_R:/\r+/g,COMMENT:""};r.EXPRESSION_NODES={CONDITION_NODE:0,CONJUNCTION_NODE:1,DISJUNCTION_NODE:2};r.init=function(){this.tokenizer.init();if(!this.checker.supportsJS()){this.checker.augmentJS()}if(!this.checker.supportsCSS()||true){this.checker.watchCSS()}};r.checker={supportsJS:function(){return typeof e.CSS==="object"&&typeof e.CSS.supports==="function"},augmentJS:function(){if(typeof e.CSS==="undefined"){e.CSS={}}e.CSS.supports=function(e,t){var n=typeof t==="string"||typeof t==="number"?e+": "+t:e;return r.parser.parse(r.tokenizer.tokenize(n)).getValue()}},supportsCSS:function(){var t=e.document.createElement("style"),n=e.document.createElement("div"),r=e.document.body,i="#fqPolyfillTestElem { display: block; } "+"@supports (display: inline) { #fqPolyfillTestElem { display: inline; } }",s;n.id="fqPolyfillTestElem";t.appendChild(e.document.createTextNode(i));r.appendChild(t);r.appendChild(n);s=e.getComputedStyle(n).display==="inline";r.removeChild(t);r.removeChild(n);return s},watchCSS:function(){r.styleFix.register(this.augmentCSS.bind(this));setTimeout(function(){n('link[rel="stylesheet"]').forEach(r.styleFix.link)},10);e.document.addEventListener("DOMContentLoaded",r.styleFix.process,false)},augmentCSS:function(e,t,n){var r;e=this.deleteCSSComments(e);r=this.findSupportsParts(e);if(r.length>0){r.forEach(function(t){e=e.replace(t,this.substituteSupportsPart(t))}.bind(this))}return e},findSupportsParts:function(e){var t,n,r=[];while((t=e.indexOf("@supports"))!==-1){n=this.getRulesInParens(e.slice(t));r.push(n);e=e.replace(n,"")}return r},getRulesInParens:function(e){var t=0,n="",r,i;do{r=e.indexOf("{");i=e.indexOf("}");if(r<i&&r!==-1){t++;n+=e.slice(0,r+1);e=e.slice(r+1)}else if(i!==-1){t--;n+=e.slice(0,i+1);e=e.slice(i+1)}}while(t>0&&(r!==-1||i!==-1)&&t<5);return n},substituteSupportsPart:function(e){var t=e.replace("@supports",""),n;t=t.slice(0,t.indexOf("{")).trim();if(r.parser.parse(r.tokenizer.tokenize(t)).getValue()){n=e.slice(e.indexOf("{")+1,e.length-1);return n}else{return""}},deleteCSSComments:function(e){var t=e.indexOf("/*"),n=e.indexOf("*/")+2,r=false;if(t>-1){if(n===-1||t>n){throw"Parse error: unterminated comment"}e=e.replace(e.substr(t,n-t),"");return this.deleteCSSComments(e)}return e}};r.styleFix={postfix:"fqpolyfill",link:function(t){try{if(t.rel!=="stylesheet"||t.hasAttribute("data-"+r.postfix)){return}}catch(n){return}var i=t.href||t.getAttribute("data-href"),s=i.replace(/[^\/]+$/,""),o=(/^[a-z]{3,10}:/.exec(s)||[""])[0],u=(/^[a-z]{3,10}:\/\/[^\/]+/.exec(s)||[""])[0],a=/^([^?]*)\??/.exec(i)[1],f=t.parentNode,l=new XMLHttpRequest,c;l.onreadystatechange=function(){if(l.readyState===4){c()}};c=function(){var n=l.responseText;if(n&&t.parentNode&&(!l.status||l.status<400||l.status>600)){n=r.styleFix.fix(n,true,t);if(s){n=n.replace(/url\(\s*?((?:"|')?)(.+?)\1\s*?\)/gi,function(e,t,n){if(/^([a-z]{3,10}:|#)/i.test(n)){return e}else if(/^\/\//.test(n)){return'url("'+o+n+'")'}else if(/^\//.test(n)){return'url("'+u+n+'")'}else if(/^\?/.test(n)){return'url("'+a+n+'")'}else{return'url("'+s+n+'")'}});var i=s.replace(/([\\\^\$*+[\]?{}.=!:(|)])/g,"\\$1");n=n.replace(new RegExp("\\b(behavior:\\s*?url\\('?\"?)"+i,"gi"),"$1")}var c=e.document.createElement("style");c.textContent=n;c.media=t.media;c.disabled=t.disabled;c.setAttribute("data-href",t.getAttribute("href"));f.insertBefore(c,t);f.removeChild(t);c.media=t.media}};try{l.open("GET",i);l.send(null)}catch(n){if(typeof XDomainRequest!=="undefined"){l=new XDomainRequest;l.onerror=l.onprogress=function(){};l.onload=c;l.open("GET",i);l.send(null)}}t.setAttribute("data-"+r.styleFix.postfix+"progress","")},styleElement:function(e){if(e.hasAttribute("data-"+r.styleFix.postfix)){return}var t=e.disabled;e.textContent=r.styleFix.fix(e.textContent,true,e);e.disabled=t},styleAttribute:function(e){var t=e.getAttribute("style");t=r.styleFix.fix(t,false,e);e.setAttribute("style",t)},process:function(){n('link[rel="stylesheet"]:not([data-'+r.styleFix.postfix+"progress])").forEach(r.styleFix.link);n("style").forEach(r.styleFix.styleElement);n("[style]").forEach(r.styleFix.styleAttribute)},register:function(e,t){(r.styleFix.fixers=r.styleFix.fixers||[]).splice(t===undefined?r.styleFix.fixers.length:t,0,e)},fix:function(e,t,n){for(var i=0;i<r.styleFix.fixers.length;i++){e=r.styleFix.fixers[i](e,t,n)||e}return e},camelCase:function(e){return e.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()}).replace("-","")},deCamelCase:function(e){return e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()})}};r.tokenizer={definitions:{},init:function(){this.definitions[r.TERMINALS.OR]=/^or/i;this.definitions[r.TERMINALS.AND]=/^and/i;this.definitions[r.TERMINALS.NOT]=/^not/i;this.definitions[r.TERMINALS.OPEN_BRACKET]=/^\(/;this.definitions[r.TERMINALS.CLOSE_BRACKET]=/^\)/;this.definitions[r.TERMINALS.SINGLE_QUOTED_CONTENT]=/^\'.+',?/;this.definitions[r.TERMINALS.DOUBLE_QUOTED_CONTENT]=/^\".+",?/;this.definitions[r.TERMINALS.DOUBLE_COLON]=/^:/;this.definitions[r.TERMINALS.RULENAME]=/^-?[a-zA-Z0-9%\.!\/#,]+[a-zA-Z0-9-%\.,\/#]*/;this.definitions[r.TERMINALS.ARITHMETIC]=/^(\+|\-|\/|\*)/},sanitize:function(e){e=e.replace(r.CHARACTER_SETS.NEWLINE_N," ").replace(r.CHARACTER_SETS.NEWLINE_R," ").trim();return e},tokenize:function(e){var t,n=[],r;e=this.sanitize(e);while(e!==""){for(r in this.definitions){if(this.definitions.hasOwnProperty(r)){t=this.definitions[r].exec(e);if(t){n.push({token:parseInt(r,10),sequence:t[0]});e=e.replace(t[0],"").trim();break}}}if(!t){throw"Parse error: Unexpected input: "+e}}return n}};r.supportChecker={testLiterally:[/[tT]?ransformStyle$/],inject:function(t,n,r){var i=e.document.createElement("div"),s=e.document.body,o;if(n){i.style.cssText=t;s.appendChild(i)}o=r(i);if(n){i.parentNode.removeChild(i)}return!!o},camelize:function(e){if(e.indexOf("-ms-")===0){e=e.replace("-ms","ms")}return e.replace(/-[a-zA-Z]/g,function(e,t,n){return n[t+1].toUpperCase()})},declaration:function(e,t){var n,r=e+": "+t,i=this.camelize(e),s,o=function(e,t){return this.inject(r,!!t,function(t){return typeof t.style[i]==="string"&&e(t)})}.bind(this);for(s=0;s<this.testLiterally.length;s++){if(this.testLiterally[s].exec(i)){n=o(function(e){return e.style[i]===t},true)}}if(t.indexOf("rgba(")!==-1){n=o(function(e){return e.style[i].indexOf("rgba(")!==-1},true)}if(t.indexOf("hsla(")!==-1&&n!==false){n=o(function(e){return e.style[i].indexOf("rgba(")!==-1||e.style[i].indexOf("hsla(")!==-1},true)}if(t.indexOf("-gradient(")!==-1&&n!==false){n=o(function(e){return e.style[i].indexOf("gradient")!==-1},true)}if(e.indexOf("background")!==-1&&t.indexOf(",")!==-1&&t.indexOf("-gradient(")===-1&&n!==false){e=i="background";t="url(https://),url(https://),red url(https://)";r=e+": "+t,n=o(function(e){return/(url\s*\(.*?){3}/.test(e.style.background)},true)}if(t.indexOf("calc(")!==-1&&n!==false){n=o(function(e){return e.style[i].indexOf("calc(")!==-1},true)}if(typeof n==="undefined"){n=o(function(e){return true})}return n}};var i=function(){this.isNegated=false};i.prototype.negate=function(){this.isNegated=!this.isNegated};i.prototype.includeNegation=function(e){if(this.isNegated){return!e}else{return e}};var s=function(e,t){i.apply(this,arguments);this.declarationName=e;this.declarationValue=t};s.prototype=Object.create(i.prototype);s.prototype.getType=function(){return r.EXPRESSION_NODES.CONDITION_NODE};s.prototype.getValue=function(){var e=r.supportChecker.declaration(this.declarationName,this.declarationValue);return this.includeNegation(e)};var o=function(){var e=Array.prototype.slice.call(arguments),t;this.conditions=[];for(t=0;t<e.length;t++){this.add(e[t])}};o.prototype.add=function(e){this.conditions.push(e)};var u=function(){i.apply(this,arguments);o.apply(this,arguments)};u.prototype=t(Object.create(i.prototype),Object.create(o.prototype));u.prototype.getType=function(){return r.EXPRESSION_NODES.CONJUNCTION_NODE};u.prototype.getValue=function(){var e=true,t;for(t=0;t<this.conditions.length;t++){if(this.conditions[t].getValue()===false){e=false;break}}return this.includeNegation(e)};var a=function(){i.apply(this,arguments);o.apply(this,arguments)};a.prototype=t(Object.create(i.prototype),Object.create(o.prototype));a.prototype.getType=function(){return r.EXPRESSION_NODES.DISJUNCTION_NODE};a.prototype.getValue=function(){var e=false,t;for(t=0;t<this.conditions.length;t++){if(this.conditions[t].getValue()===true){e=true;break}}return this.includeNegation(e)};r.parser={tokens:null,lookahead:null,parse:function(e){var t;this.tokens=e.slice();this.lookahead=this.tokens[0];t=this.supportsCondition();if(this.lookahead.token!==r.TERMINALS._END){throw'Parse error: unexpected sequence at the end of input: "'+this.lookahead.sequence+'"'}return t},nextToken:function(){this.tokens.shift();if(this.tokens.length===0){this.lookahead={token:r.TERMINALS._END,sequence:""}}else{this.lookahead=this.tokens[0]}},supportsCondition:function(){var e,t,n;if(this.lookahead.token===r.TERMINALS.NOT){this.nextToken();e=this.supportsConditionInParens();e.negate();return e}else{e=this.supportsConditionInParens();if(this.lookahead.token===r.TERMINALS.AND){t=new u(e);while(this.lookahead.token===r.TERMINALS.AND){this.nextToken();t.add(this.supportsConditionInParens())}return t}if(this.lookahead.token===r.TERMINALS.OR){n=new a(e);while(this.lookahead.token===r.TERMINALS.OR){this.nextToken();n.add(this.supportsConditionInParens())}return n}return e}},supportsConditionInParens:function(){var e;if(this.lookahead.token===r.TERMINALS.OPEN_BRACKET){this.nextToken();if(this.lookahead.token===r.TERMINALS.RULENAME){e=this.declaration()}else{e=this.supportsCondition()}if(this.lookahead.token!==r.TERMINALS.CLOSE_BRACKET){throw'Parse error: unexpected sequence "'+this.lookahead.sequence+'", expecting ")"'}this.nextToken();return e}else{throw'Parse error: unexpected sequence "'+this.lookahead.sequence+'", expecting "("'}},declaration:function(){var e=this.lookahead.sequence,t="";this.nextToken();if(this.lookahead.token===r.TERMINALS.DOUBLE_COLON){this.nextToken();t=this.declarationValue();if(!t){throw'Parse error: unexpected sequence "'+this.lookahead.sequence+'", expecting declaration value'}return new s(e,t)}else{throw'Parse error: unexpected sequence "'+this.lookahead.sequence+'", expecting ":"'}},declarationValue:function(){var e="",t="";if(this.lookahead.token===r.TERMINALS.RULENAME){e+=this.lookahead.sequence;this.nextToken()}if(this.lookahead.token===r.TERMINALS.ARITHMETIC){e+=" "+this.lookahead.sequence+" ";this.nextToken();e+=this.declarationValue()}if(this.lookahead.token===r.TERMINALS.OPEN_BRACKET){e+=this.lookahead.sequence;this.nextToken();e+=this.declarationValue();if(this.lookahead.token!==r.TERMINALS.CLOSE_BRACKET){throw'Parse error: unexpected sequence "'+this.lookahead.sequence+'", expecting ")"'}e+=this.lookahead.sequence;this.nextToken()}if(this.lookahead.token===r.TERMINALS.SINGLE_QUOTED_CONTENT){e+=this.lookahead.sequence;this.nextToken()}if(this.lookahead.token===r.TERMINALS.DOUBLE_QUOTED_CONTENT){e+=this.lookahead.sequence;this.nextToken()}if(this.lookahead.token===r.TERMINALS.RULENAME||this.lookahead.token===r.TERMINALS.ARITHMETIC||this.lookahead.token===r.TERMINALS.OPEN_BRACKET||this.lookahead.token===r.TERMINALS.SINGLE_QUOTED_CONTENT||this.lookahead.token===r.TERMINALS.DOUBLE_QUOTED_CONTENT){return e+" "+this.declarationValue()}return e}};r.init()})(this)
